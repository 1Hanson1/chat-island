# Question

- [#fitten_ref_2#] context file path: src/main/java/io/g8/customai/customer_service/controller/CsAiController.java

#fitten_ref_2# 转换一份

# Answer

根据提供的 `CsAiController.java` 文件内容，以下是为该控制器生成的接口文档：

---

# 客户服务接口文档

## 概述
该文档描述了客户服务功能的 RESTful API 接口，包括用户提问、用户查询历史、客服获取待处理消息以及客服完成回复等功能。

## 基础信息
- **基础路径**：`/api/help`
- **认证方式**：部分接口需要在请求头中携带 `Authorization` 字段，格式为 `Bearer <token>`。

## 接口列表

### 1. 用户提问接口
- **路径**：`/chat`
- **方法**：`POST`
- **请求参数**：
  - 请求体 (Body): JSON 格式，包含以下字段
    - `uid` (必填): 用户 UID
    - `msg` (必填): 用户消息内容
- **成功响应**：
  - `Content-Type`: `application/json`
  - `result`: 包含对话结果的详细信息
- **失败响应**：
  - `Content-Type`: `application/json`
  - `error`: 错误信息

### 2. 用户查询历史
- **路径**：`/inquiries`
- **方法**：`GET`
- **请求参数**：
  - `uid` (必填, Query): 用户 UID
- **成功响应**：
  - `Content-Type`: `application/json`
  - `status`: "success"
  - `data`: 用户的查询历史列表，包含 `CsInquiry` 对象
- **失败响应**：
  - `Content-Type`: `application/json`
  - `error`: 错误信息

### 3. 客服获取待处理消息
- **路径**：`/inquiries4cs`
- **方法**：`GET`
- **请求参数**：
  - `uid` (必填, Query): 客服 UID
- **成功响应**：
  - `Content-Type`: `application/json`
  - `status`: "success"
  - `data`: 待处理的查询列表，包含 `CsInquiry` 对象
- **失败响应**：
  - `Content-Type`: `application/json`
  - `error`: 错误信息

### 4. 客服完成回复
- **路径**：`/complete`
- **方法**：`POST`
- **请求参数**：
  - `Authorization` (Header): JWT 令牌（仅用于验证客服身份）
  - 请求体 (Body): JSON 格式，包含以下字段
    - `csUid` (可选, 默认从 JWT 解析): 客服 UID
    - `inquiryId` (必填): 查询 ID
    - `replyMsg` (必填): 客服回复内容
- **成功响应**：
  - `Content-Type`: `application/json`
  - `status`: "success"
  - `data`: 包含客服回复的详细信息，格式为 `"问题 %s 已由客服 %s 回复"`
- **失败响应**：
  - `Content-Type`: `application/json`
  - `status`: "error"
  - `data`: 错误信息，例如 `"问题已被处理或不存在"`

## 辅助方法说明

### 1. 提取并验证参数
- **方法**：`extractAndValidate`
- **参数**：
  - `input`: 请求体中的参数
  - `key`: 参数键
  - `defaultValue`: 默认值
- **返回值**：
  - 验证后的参数值或默认值

### 2. 验证管理员角色
- **方法**：`validateAdminRole`
- **参数**：
  - `authHeader`: 请求头中的认证信息
  - `uid`: 用户 ID
- **返回值**：
  - `null`: 如果验证通过
  - `ResponseEntity<String>`: 如果验证失败，包含错误信息

### 3. 提取消息文本
- **方法**：`extractMessageText`
- **参数**：
  - `message`: `ChatMessage` 类型的消息
- **返回值**：
  - 消息的具体文本内容

---

以上文档提供了 `CsAiController` 类中所有公开接口的详细说明，包括请求方法、路径、参数、响应格式及权限要求。