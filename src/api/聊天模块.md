# Question

- [#fitten_ref_0#] context file path: src/main/java/io/g8/customai/knowledge/controller/RagController.java

#fitten_ref_0# 转换为一份接口文档

# Answer

根据提供的 `RagController.java` 文件内容，以下是为该控制器生成的接口文档：

---

# 知识库接口文档

## 概述
该文档描述了知识库管理的 RESTful API 接口，包括创建知识库、获取知识库列表、获取知识库信息、删除知识库等操作，以及文档上传和知识检索功能。

## 基础信息
- **基础路径**：`/api/knowledge`
- **认证方式**：所有接口均需要在请求头中携带 `Authorization` 字段，格式为 `Bearer <token>`。

## 接口列表

### 1. 创建新知识库
- **路径**：`/new`
- **方法**：`POST`
- **请求参数**：
  - `Authorization` (Header): JWT 令牌
  - `uid` (可选, Query): 用户 ID
  - 请求体 (Body): JSON 格式，包含以下字段
    - `name` (必填): 知识库名称
    - `tags` (可选): 标签列表
    - `description` (可选): 知识库描述
- **成功响应**：
  - `status`: "success"
  - `message`: "知识库创建成功"
  - `data`: 包含知识库的详细信息
    - `kid`: 知识库 ID
    - `name`: 知识库名称
    - `tags`: 标签列表
    - `description`: 知识库描述
    - `createdTime`: 创建时间
- **失败响应**：
  - `error`: 错误信息

### 2. 获取用户所有知识库信息
- **路径**：`/list`
- **方法**：`GET`
- **请求参数**：
  - `Authorization` (Header): JWT 令牌
  - `uid` (可选, Query): 用户 ID
- **成功响应**：
  - `status`: "success"
  - `data`: 知识库列表
  - `total`: 知识库总数
- **失败响应**：
  - `error`: 错误信息

### 3. 获取特定知识库详细信息
- **路径**：`/info`
- **方法**：`GET`
- **请求参数**：
  - `Authorization` (Header): JWT 令牌
  - `uid` (可选, Query): 用户 ID
  - `kid` (必填, Query): 知识库 ID
- **成功响应**：
  - `status`: "success"
  - `data`: 知识库详细信息
- **失败响应**：
  - `error`: 错误信息

### 4. 删除特定知识库
- **路径**：`/delete-kb`
- **方法**：`DELETE`
- **请求参数**：
  - `Authorization` (Header): JWT 令牌
  - `uid` (可选, Query): 用户 ID（当 `uid` 为空时，从 JWT 中解析）
  - `kid` (必填, Query): 知识库 ID
- **权限**：普通用户只能删除自己的知识库，管理员可以删除其他用户的知识库。
- **成功响应**：
  - `status`: "success"
  - `message`: "知识库删除成功"
- **失败响应**：
  - `error`: 错误信息

### 5. 删除知识库中的特定文档
- **路径**：`/delete-doc`
- **方法**：`DELETE`
- **请求参数**：
  - `Authorization` (Header): JWT 令牌
  - `docId` (必填, Query): 文档 ID
- **成功响应**：
  - `status`: "success"
  - `message`: "文档删除成功"
- **失败响应**：
  - `error`: 错误信息

### 6. 文档上传接口（使用 Chroma 存储）
- **路径**：`/upload`
- **方法**：`POST`
- **请求参数**：
  - `Authorization` (Header): JWT 令牌
  - `uid` (可选, Query): 用户 ID
  - `kid` (必填, Query): 知识库 ID
  - `file` (必填, Form): 待上传的文档文件
- **支持的文件格式**：
  - `txt`, `pdf`, `doc`, `docx`, `md`, `html`, `htm`
- **成功响应**：
  - `status`: "success"
  - `message`: "文档上传成功"
  - `data`: 包含上传文档的详细信息
    - `docId`: 文档 ID
    - `filename`: 文件名称
    - `segments`: 文档段落数
    - `fileSize`: 文件大小 (字节)
- **失败响应**：
  - `error`: 错误信息

### 7. 知识检索接口（使用 Chroma 搜索）
- **路径**：`/search`
- **方法**：`POST`
- **请求参数**：
  - `Authorization` (Header): JWT 令牌
  - `uid` (可选, Query): 用户 ID（当 `uid` 为空时，从 JWT 中解析）
  - `kid` (必填, Body): 知识库 ID
  - `question` (必填, Body): 查询问题
  - `maxResults` (可选, Body, 默认值: 3): 返回的最大结果数
  - `minScore` (可选, Body, 默认值: 0.7): 匹配文档的最低相似度分数
- **成功响应**：
  - `status`: "success"
  - `data`: 搜索到的匹配项列表
    - `text`: 匹配文档内容
    - `score`: 匹配分数
    - `metadata`: 文档元数据
- **失败响应**：
  - `error`: 错误信息

### 8. 删除用户所有知识库
- **路径**：`/delete-all`
- **方法**：`DELETE`
- **请求参数**：
  - `Authorization` (Header): JWT 令牌
  - `uid` (可选, Query): 目标用户 ID（当 `uid` 为空时，从 JWT 中解析）
- **权限**：普通用户只能删除自己的知识库，管理员可以删除指定用户的知识库。
- **成功响应**：
  - `status`: "success"
  - `message`: "所有知识库删除成功"
- **失败响应**：
  - `error`: 错误信息

## 辅助方法说明
- **文档格式检查**：支持的文档格式包括 `txt`, `pdf`, `doc`, `docx`, `md`, `html`, `htm`。
- **文本预处理**：清理控制字符和多余空格，根据段落对文档进行分割。
- **用户身份解析**：从 JWT 中解析用户 ID，并进行必要的权限验证。

---

以上文档提供了 `RagController` 类中所有公开接口的详细说明，包括请求方法、路径、参数、响应格式及权限要求。

# Question

- [#fitten_ref_1#] context file path: src/main/java/io/g8/customai/chat/controller/ChatController.java

#fitten_ref_1# 转换一份

# Answer

根据提供的 `ChatController.java` 文件内容，以下是为该控制器生成的接口文档：

---

# 聊天接口文档

## 概述
该文档描述了聊天功能的 RESTful API 接口，包括创建会话、发送消息、获取聊天记录、清除聊天记录、删除会话和重命名会话等功能。

## 基础信息
- **基础路径**：`/api/chat`
- **认证方式**：所有接口均需要在请求头中携带 `Authorization` 字段，格式为 `Bearer <token>`。

## 接口列表

### 1. 流式对话测试
- **路径**：`/stream-test`
- **方法**：`POST`
- **请求参数**：
  - `Authorization` (Header): JWT 令牌
  - `sessionId` (可选, Body, 默认值: "000001"): 会话 ID
  - `msg` (可选, Body, 默认值: "你是谁"): 用户消息
  - `model` (可选, Body, 默认值: "qwen-turbo"): 模型名称
- **成功响应**：
  - `Content-Type`: `text/event-stream;charset=UTF-8`
  - 数据流形式返回对话内容
- **失败响应**：
  - `Content-Type`: `application/json`
  - `error`: 错误信息

### 2. 创建新会话
- **路径**：`/session/create`
- **方法**：`POST`
- **请求参数**：
  - `Authorization` (Header): JWT 令牌
- **成功响应**：
  - `sessionId`: 新创建的会话 ID
- **失败响应**：
  - `error`: 错误信息

### 3. 发送知识增强流式消息
- **路径**：`/say`
- **方法**：`POST`
- **请求参数**：
  - `Authorization` (Header): JWT 令牌
  - `sessionId` (可选, Body, 默认值: "000001"): 会话 ID
  - `msg` (可选, Body, 默认值: "你是谁"): 用户消息
  - `kid` (可选, Body): 知识库 ID
  - `model` (可选, Body, 默认值: "qwen-turbo"): 模型名称
- **成功响应**：
  - `Content-Type`: `text/event-stream;charset=UTF-8`
  - 数据流形式返回增强后的对话内容
- **失败响应**：
  - `Content-Type`: `application/json`
  - `error`: 错误信息

### 4. 清理聊天记录
- **路径**：`/session/clear`
- **方法**：`DELETE`
- **请求参数**：
  - `Authorization` (Header): JWT 令牌
  - `sessionId` (必填, Body): 会话 ID
- **成功响应**：
  - `聊天记录清理成功`
- **失败响应**：
  - `Content-Type`: `application/json`
  - `error`: 错误信息

### 5. 获取聊天记录（管理员可用）
- **路径**：`/session/{uid}/{sessionId}`
- **方法**：`GET`
- **请求参数**：
  - `Authorization` (Header): JWT 令牌
  - `uid` (必填, Path): 用户 ID
  - `sessionId` (必填, Path): 会话 ID
- **成功响应**：
  - `Content-Type`: `application/json`
  - 包含聊天记录的列表
    - `type`: 消息类型 (`UserMessage`, `AiMessage`, `SystemMessage`, `ToolExecutionResultMessage`)
    - `text`: 消息内容
    - `timestamp`: 时间戳
- **失败响应**：
  - `Content-Type`: `application/json`
  - `error`: 错误信息

### 6. 获取用户会话列表（管理员可用）
- **路径**：`/sessions/{uid}`
- **方法**：`GET`
- **请求参数**：
  - `Authorization` (Header): JWT 令牌
  - `uid` (必填, Path): 用户 ID
- **成功响应**：
  - `Content-Type`: `application/json`
  - 包含用户会话的列表
    - `sessionId`: 会话 ID
    - `status`: 会话状态
- **失败响应**：
  - `Content-Type`: `application/json`
  - `error`: 错误信息

### 7. 删除特定会话
- **路径**：`/session/{sessionId}`
- **方法**：`DELETE`
- **请求参数**：
  - `Authorization` (Header): JWT 令牌
  - `sessionId` (必填, Path): 会话 ID
- **成功响应**：
  - `会话历史已清除`
- **失败响应**：
  - `Content-Type`: `application/json`
  - `error`: 错误信息

### 8. 重命名会话
- **路径**：`/sessions/{sessionId}/rename`
- **方法**：`PUT`
- **请求参数**：
  - `Authorization` (Header): JWT 令牌
  - `sessionId` (必填, Path): 会话 ID
  - 请求体 (Body): JSON 格式，包含以下字段
    - `name` (必填): 新的会话名称
- **成功响应**：
  - `会话已重命名`
- **失败响应**：
  - `Content-Type`: `application/json`
  - `error`: 错误信息

## 辅助方法说明

### 1. 提取并验证参数
- **方法**：`extractAndValidate`
- **参数**：
  - `input`: 请求体中的参数
  - `key`: 参数键
  - `defaultValue`: 默认值
- **返回值**：
  - 验证后的参数值或默认值

### 2. 验证管理员角色
- **方法**：`validateAdminRole`
- **参数**：
  - `authHeader`: 请求头中的认证信息
  - `uid`: 用户 ID
- **返回值**：
  - `null`: 如果验证通过
  - `ResponseEntity<String>`: 如果验证失败，包含错误信息

### 3. 提取消息文本
- **方法**：`extractMessageText`
- **参数**：
  - `message`: `ChatMessage` 类型的消息
- **返回值**：
  - 消息的具体文本内容

---

以上文档提供了 `ChatController` 类中所有公开接口的详细说明，包括请求方法、路径、参数、响应格式及权限要求。