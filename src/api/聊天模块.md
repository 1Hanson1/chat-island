# Question

- [#fitten_ref_1#] context file path: src/main/java/io/g8/customai/chat/controller/ChatController.java

#fitten_ref_1# 转换一份

# Answer

根据提供的 `ChatController.java` 文件内容，以下是为该控制器生成的接口文档：

---

# 聊天接口文档

## 概述
该文档描述了聊天功能的 RESTful API 接口，包括创建会话、发送消息、获取聊天记录、清除聊天记录、删除会话和重命名会话等功能。

## 基础信息
- **基础路径**：`/api/chat`
- **认证方式**：所有接口均需要在请求头中携带 `Authorization` 字段，格式为 `Bearer <token>`。

## 接口列表

### 1. 流式对话测试
- **路径**：`/stream-test`
- **方法**：`POST`
- **请求参数**：
  - `Authorization` (Header): JWT 令牌
  - `sessionId` (可选, Body, 默认值: "000001"): 会话 ID
  - `msg` (可选, Body, 默认值: "你是谁"): 用户消息
  - `model` (可选, Body, 默认值: "qwen-turbo"): 模型名称
- **成功响应**：
  - `Content-Type`: `text/event-stream;charset=UTF-8`
  - 数据流形式返回对话内容
- **失败响应**：
  - `Content-Type`: `application/json`
  - `error`: 错误信息

### 2. 创建新会话
- **路径**：`/session/create`
- **方法**：`POST`
- **请求参数**：
  - `Authorization` (Header): JWT 令牌
- **成功响应**：
  - `sessionId`: 新创建的会话 ID
- **失败响应**：
  - `error`: 错误信息

### 3. 发送知识增强流式消息
- **路径**：`/say`
- **方法**：`POST`
- **请求参数**：
  - `Authorization` (Header): JWT 令牌
  - `sessionId` (可选, Body, 默认值: "000001"): 会话 ID
  - `msg` (可选, Body, 默认值: "你是谁"): 用户消息
  - `kid` (可选, Body): 知识库 ID
  - `model` (可选, Body, 默认值: "qwen-turbo"): 模型名称
- **成功响应**：
  - `Content-Type`: `text/event-stream;charset=UTF-8`
  - 数据流形式返回增强后的对话内容
- **失败响应**：
  - `Content-Type`: `application/json`
  - `error`: 错误信息

### 4. 清理聊天记录
- **路径**：`/session/clear`
- **方法**：`DELETE`
- **请求参数**：
  - `Authorization` (Header): JWT 令牌
  - `sessionId` (必填, Body): 会话 ID
- **成功响应**：
  - `聊天记录清理成功`
- **失败响应**：
  - `Content-Type`: `application/json`
  - `error`: 错误信息

### 5. 获取聊天记录（管理员可用）
- **路径**：`/session/{uid}/{sessionId}`
- **方法**：`GET`
- **请求参数**：
  - `Authorization` (Header): JWT 令牌
  - `uid` (必填, Path): 用户 ID
  - `sessionId` (必填, Path): 会话 ID
- **成功响应**：
  - `Content-Type`: `application/json`
  - 包含聊天记录的列表
    - `type`: 消息类型 (`UserMessage`, `AiMessage`, `SystemMessage`, `ToolExecutionResultMessage`)
    - `text`: 消息内容
    - `timestamp`: 时间戳
- **失败响应**：
  - `Content-Type`: `application/json`
  - `error`: 错误信息

### 6. 获取用户会话列表（管理员可用）
- **路径**：`/sessions/{uid}`
- **方法**：`GET`
- **请求参数**：
  - `Authorization` (Header): JWT 令牌
  - `uid` (必填, Path): 用户 ID
- **成功响应**：
  - `Content-Type`: `application/json`
  - 包含用户会话的列表
    - `sessionId`: 会话 ID
    - `status`: 会话状态
- **失败响应**：
  - `Content-Type`: `application/json`
  - `error`: 错误信息

### 7. 删除特定会话
- **路径**：`/session/{sessionId}`
- **方法**：`DELETE`
- **请求参数**：
  - `Authorization` (Header): JWT 令牌
  - `sessionId` (必填, Path): 会话 ID
- **成功响应**：
  - `会话历史已清除`
- **失败响应**：
  - `Content-Type`: `application/json`
  - `error`: 错误信息

### 8. 重命名会话
- **路径**：`/sessions/{sessionId}/rename`
- **方法**：`PUT`
- **请求参数**：
  - `Authorization` (Header): JWT 令牌
  - `sessionId` (必填, Path): 会话 ID
  - 请求体 (Body): JSON 格式，包含以下字段
    - `name` (必填): 新的会话名称
- **成功响应**：
  - `会话已重命名`
- **失败响应**：
  - `Content-Type`: `application/json`
  - `error`: 错误信息

## 辅助方法说明

### 1. 提取并验证参数
- **方法**：`extractAndValidate`
- **参数**：
  - `input`: 请求体中的参数
  - `key`: 参数键
  - `defaultValue`: 默认值
- **返回值**：
  - 验证后的参数值或默认值

### 2. 验证管理员角色
- **方法**：`validateAdminRole`
- **参数**：
  - `authHeader`: 请求头中的认证信息
  - `uid`: 用户 ID
- **返回值**：
  - `null`: 如果验证通过
  - `ResponseEntity<String>`: 如果验证失败，包含错误信息

### 3. 提取消息文本
- **方法**：`extractMessageText`
- **参数**：
  - `message`: `ChatMessage` 类型的消息
- **返回值**：
  - 消息的具体文本内容

---

以上文档提供了 `ChatController` 类中所有公开接口的详细说明，包括请求方法、路径、参数、响应格式及权限要求。