# Question

- [#fitten_ref_0#] context file path: src/main/java/io/g8/customai/knowledge/controller/RagController.java

#fitten_ref_0# 转换为一份接口文档

# Answer

根据提供的 `RagController.java` 文件内容，以下是为该控制器生成的接口文档：

---

# 知识库接口文档

## 概述
该文档描述了知识库管理的 RESTful API 接口，包括创建知识库、获取知识库列表、获取知识库信息、删除知识库等操作，以及文档上传和知识检索功能。

## 基础信息
- **基础路径**：`/api/knowledge`
- **认证方式**：所有接口均需要在请求头中携带 `Authorization` 字段，格式为 `Bearer <token>`。

## 接口列表

### 1. 创建新知识库
- **路径**：`/new`
- **方法**：`POST`
- **请求参数**：
  - `Authorization` (Header): JWT 令牌
  - `uid` (可选, Query): 用户 ID
  - 请求体 (Body): JSON 格式，包含以下字段
    - `name` (必填): 知识库名称
    - `tags` (可选): 标签列表
    - `description` (可选): 知识库描述
- **成功响应**：
  - `status`: "success"
  - `message`: "知识库创建成功"
  - `data`: 包含知识库的详细信息
    - `kid`: 知识库 ID
    - `name`: 知识库名称
    - `tags`: 标签列表
    - `description`: 知识库描述
    - `createdTime`: 创建时间
- **失败响应**：
  - `error`: 错误信息

### 2. 获取用户所有知识库信息
- **路径**：`/list`
- **方法**：`GET`
- **请求参数**：
  - `Authorization` (Header): JWT 令牌
  - `uid` (可选, Query): 用户 ID
- **成功响应**：
  - `status`: "success"
  - `data`: 知识库列表
  - `total`: 知识库总数
- **失败响应**：
  - `error`: 错误信息

### 3. 获取特定知识库详细信息
- **路径**：`/info`
- **方法**：`GET`
- **请求参数**：
  - `Authorization` (Header): JWT 令牌
  - `uid` (可选, Query): 用户 ID
  - `kid` (必填, Query): 知识库 ID
- **成功响应**：
  - `status`: "success"
  - `data`: 知识库详细信息
- **失败响应**：
  - `error`: 错误信息

### 4. 删除特定知识库
- **路径**：`/delete-kb`
- **方法**：`DELETE`
- **请求参数**：
  - `Authorization` (Header): JWT 令牌
  - `uid` (可选, Query): 用户 ID（当 `uid` 为空时，从 JWT 中解析）
  - `kid` (必填, Query): 知识库 ID
- **权限**：普通用户只能删除自己的知识库，管理员可以删除其他用户的知识库。
- **成功响应**：
  - `status`: "success"
  - `message`: "知识库删除成功"
- **失败响应**：
  - `error`: 错误信息

### 5. 删除知识库中的特定文档
- **路径**：`/delete-doc`
- **方法**：`DELETE`
- **请求参数**：
  - `Authorization` (Header): JWT 令牌
  - `docId` (必填, Query): 文档 ID
- **成功响应**：
  - `status`: "success"
  - `message`: "文档删除成功"
- **失败响应**：
  - `error`: 错误信息

### 6. 文档上传接口（使用 Chroma 存储）
- **路径**：`/upload`
- **方法**：`POST`
- **请求参数**：
  - `Authorization` (Header): JWT 令牌
  - `uid` (可选, Query): 用户 ID
  - `kid` (必填, Query): 知识库 ID
  - `file` (必填, Form): 待上传的文档文件
- **支持的文件格式**：
  - `txt`, `pdf`, `doc`, `docx`, `md`, `html`, `htm`
- **成功响应**：
  - `status`: "success"
  - `message`: "文档上传成功"
  - `data`: 包含上传文档的详细信息
    - `docId`: 文档 ID
    - `filename`: 文件名称
    - `segments`: 文档段落数
    - `fileSize`: 文件大小 (字节)
- **失败响应**：
  - `error`: 错误信息

### 7. 知识检索接口（使用 Chroma 搜索）
- **路径**：`/search`
- **方法**：`POST`
- **请求参数**：
  - `Authorization` (Header): JWT 令牌
  - `uid` (可选, Query): 用户 ID（当 `uid` 为空时，从 JWT 中解析）
  - `kid` (必填, Body): 知识库 ID
  - `question` (必填, Body): 查询问题
  - `maxResults` (可选, Body, 默认值: 3): 返回的最大结果数
  - `minScore` (可选, Body, 默认值: 0.7): 匹配文档的最低相似度分数
- **成功响应**：
  - `status`: "success"
  - `data`: 搜索到的匹配项列表
    - `text`: 匹配文档内容
    - `score`: 匹配分数
    - `metadata`: 文档元数据
- **失败响应**：
  - `error`: 错误信息

### 8. 删除用户所有知识库
- **路径**：`/delete-all`
- **方法**：`DELETE`
- **请求参数**：
  - `Authorization` (Header): JWT 令牌
  - `uid` (可选, Query): 目标用户 ID（当 `uid` 为空时，从 JWT 中解析）
- **权限**：普通用户只能删除自己的知识库，管理员可以删除指定用户的知识库。
- **成功响应**：
  - `status`: "success"
  - `message`: "所有知识库删除成功"
- **失败响应**：
  - `error`: 错误信息

## 辅助方法说明
- **文档格式检查**：支持的文档格式包括 `txt`, `pdf`, `doc`, `docx`, `md`, `html`, `htm`。
- **文本预处理**：清理控制字符和多余空格，根据段落对文档进行分割。
- **用户身份解析**：从 JWT 中解析用户 ID，并进行必要的权限验证。

---

以上文档提供了 `RagController` 类中所有公开接口的详细说明，包括请求方法、路径、参数、响应格式及权限要求。